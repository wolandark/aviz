package main

import (
	"github.com/gdamore/tcell/v2"
)

type ColorScheme struct {
	Name  string
	Stops []colorStop
}

type colorStop struct {
	R, G, B int32
}

func (cs ColorScheme) At(t float64) tcell.Color {
	if t <= 0 {
		s := cs.Stops[0]
		return tcell.NewRGBColor(s.R, s.G, s.B)
	}
	if t >= 1 {
		s := cs.Stops[len(cs.Stops)-1]
		return tcell.NewRGBColor(s.R, s.G, s.B)
	}

	n := len(cs.Stops) - 1
	pos := t * float64(n)
	idx := int(pos)
	frac := pos - float64(idx)

	if idx >= n {
		idx = n - 1
		frac = 1.0
	}

	a := cs.Stops[idx]
	b := cs.Stops[idx+1]

	r := int32(float64(a.R) + frac*float64(b.R-a.R))
	g := int32(float64(a.G) + frac*float64(b.G-a.G))
	bl := int32(float64(a.B) + frac*float64(b.B-a.B))

	return tcell.NewRGBColor(r, g, bl)
}

var allSchemes []ColorScheme

func init() {
	allSchemes = []ColorScheme{
		{
			Name: "rainbow",
			Stops: []colorStop{
				{0xFF, 0x00, 0x55},
				{0xFF, 0x44, 0x00},
				{0xFF, 0xBB, 0x00},
				{0x44, 0xFF, 0x00},
				{0x00, 0xFF, 0x88},
				{0x00, 0xCC, 0xFF},
				{0x66, 0x00, 0xFF},
				{0xFF, 0x00, 0xCC},
			},
		},
		{
			Name: "fire",
			Stops: []colorStop{
				{0x10, 0x00, 0x00},
				{0x8B, 0x00, 0x00},
				{0xFF, 0x22, 0x00},
				{0xFF, 0x66, 0x00},
				{0xFF, 0x99, 0x00},
				{0xFF, 0xCC, 0x00},
				{0xFF, 0xEE, 0x44},
				{0xFF, 0xFF, 0xCC},
			},
		},
		{
			Name: "ocean",
			Stops: []colorStop{
				{0x00, 0x00, 0x44},
				{0x00, 0x22, 0x88},
				{0x00, 0x55, 0xCC},
				{0x00, 0x88, 0xCC},
				{0x00, 0xBB, 0xCC},
				{0x00, 0xDD, 0xDD},
				{0x44, 0xFF, 0xEE},
				{0xAA, 0xFF, 0xFF},
			},
		},
		{
			Name: "neon",
			Stops: []colorStop{
				{0x22, 0x00, 0x44},
				{0x88, 0x00, 0xFF},
				{0xFF, 0x00, 0xFF},
				{0xFF, 0x00, 0x88},
				{0x00, 0xFF, 0xFF},
				{0x00, 0xFF, 0x66},
				{0x39, 0xFF, 0x14},
			},
		},
		{
			Name: "pastel",
			Stops: []colorStop{
				{0xFF, 0xB6, 0xC1},
				{0xDD, 0xA0, 0xDD},
				{0xBB, 0x88, 0xFF},
				{0xAD, 0xD8, 0xE6},
				{0x98, 0xFB, 0x98},
				{0xFF, 0xFA, 0xCD},
				{0xFF, 0xCC, 0xDD},
			},
		},
		{
			Name: "matrix",
			Stops: []colorStop{
				{0x00, 0x11, 0x00},
				{0x00, 0x33, 0x00},
				{0x00, 0x77, 0x00},
				{0x00, 0xAA, 0x00},
				{0x00, 0xDD, 0x00},
				{0x00, 0xFF, 0x00},
				{0x88, 0xFF, 0x88},
				{0xCC, 0xFF, 0xCC},
			},
		},
		{
			Name: "sunset",
			Stops: []colorStop{
				{0x1A, 0x00, 0x33},
				{0x44, 0x00, 0x66},
				{0xAA, 0x00, 0x66},
				{0xFF, 0x22, 0x66},
				{0xFF, 0x66, 0x33},
				{0xFF, 0xAA, 0x00},
				{0xFF, 0xDD, 0x00},
				{0xFF, 0xEE, 0x77},
			},
		},
		{
			Name: "aurora",
			Stops: []colorStop{
				{0x00, 0x11, 0x33},
				{0x00, 0x44, 0x66},
				{0x00, 0x99, 0x77},
				{0x00, 0xDD, 0x66},
				{0x44, 0xFF, 0x88},
				{0xAA, 0xFF, 0x44},
				{0x88, 0xDD, 0xFF},
				{0xCC, 0x88, 0xFF},
			},
		},
	}
}

func GetColorScheme(name string) ColorScheme {
	for _, cs := range allSchemes {
		if cs.Name == name {
			return cs
		}
	}
	return allSchemes[0]
}

func NextColorScheme(current ColorScheme) ColorScheme {
	for i, cs := range allSchemes {
		if cs.Name == current.Name {
			return allSchemes[(i+1)%len(allSchemes)]
		}
	}
	return allSchemes[0]
}

func PrevColorScheme(current ColorScheme) ColorScheme {
	for i, cs := range allSchemes {
		if cs.Name == current.Name {
			return allSchemes[(i-1+len(allSchemes))%len(allSchemes)]
		}
	}
	return allSchemes[0]
}

func AllSchemeNames() []string {
	names := make([]string, len(allSchemes))
	for i, cs := range allSchemes {
		names[i] = cs.Name
	}
	return names
}
